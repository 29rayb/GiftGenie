"use strict";function AppRoutes($stateProvider,$urlRouterProvider,$locationProvider,$authProvider){$urlRouterProvider.otherwise("/"),$stateProvider.state("faq",{url:"/faq",templateUrl:"app/components/faq/faq.html",controller:"faqCtrl"}).state("home",{url:"/",templateUrl:"app/components/home/home.html",controller:"HomeCtrl"}).state("my-wishlist",{url:"/my-wishlist/:id",templateUrl:"app/components/my-wishlist/my-wishlist.html",controller:"WishlistCtrl",resolve:{getUser:function(UserSvc){return UserSvc.getProfile()}}}).state("friend-wishlist",{url:"/my-wishlist/:id/friends/:fid",templateUrl:"app/components/friend-wishlist/friend-wishlist.html",controller:"FriendlistCtrl",resolve:{getUser:function(UserSvc){return UserSvc.getProfile()},getFriend:function(UserSvc,$stateParams){return UserSvc.friendProfile($stateParams.fid)}}}),$authProvider.facebook({clientId:"247255738962232",requiredUrlParams:["scope","display"],scope:["user_friends","email","user_birthday"]})}function HomeCtrl($scope,$rootScope,$state,$auth,$http,UserSvc){$rootScope.loggedIn=localStorage.getItem("satellizer_token"),$scope.authenticate=function(provider,user){$auth.authenticate(provider,user).then(function(res){$rootScope.allMyFriends=res.data.user,$state.go("my-wishlist",{id:$rootScope.pro_pic})})["catch"](function(err){})}}function NavbarCtrl($scope,$state,$auth,$rootScope,UserSvc){localStorage.getItem("satellizer_token")&&UserSvc.getProfile().then(function(res){$rootScope.display_name=res.data.displayName}),$rootScope.settings=!1,$rootScope.starred=!1,$rootScope.followersPage=!1,$rootScope.followingPage=!1,localStorage.getItem("satellizer_token")?$rootScope.infaq=localStorage.removeItem("faq"):$rootScope.infaq=localStorage.getItem("faq"),$scope.isAuthenticated=function(){return $auth.isAuthenticated()},$scope.logout=function(){$rootScope.loggedIn=void 0,$scope.friendsContainer=!1,$auth.logout(),$scope.backToHome(),$state.go("home")},$scope.backToHome=function(){localStorage.removeItem("faq"),$rootScope.infaq=null},$scope.goToWishList=function(){$rootScope.settings=!1,$rootScope.starred=!1,$rootScope.followersPage=!1,$rootScope.followingPage=!1,$state.go("my-wishlist",{id:$rootScope.pro_pic})},$scope.goToStarred=function(){$scope.goToWishList(),$rootScope.starred=!0},$scope.goToOthers=function(userObj){$scope.friendsContainer=!1,$state.go("friend-wishlist",{id:$rootScope.pro_pic,fid:userObj.id})},$scope.focused=function(){$scope.friendsContainer=!0,$scope.searchFriends()},$scope.hoverIn=function(){$scope.friendsContainer=!0},$scope.hoverOut=function(){$scope.friendsContainer=!1},$scope.searchFriends=function(){$rootScope.user.friends=$rootScope.allMyFriends,UserSvc.checkingFriendPrivacy($rootScope.user.friends).then(function(response){var publicFriends=response.data.publicFriends,length=publicFriends.length;$rootScope.userModel=[];for(var i=0;i<length;i++)$rootScope.userModel[i]={name:publicFriends[i].displayName,id:publicFriends[i].facebook}})},$scope.authenticate=function(provider,user){localStorage.removeItem("faq"),$auth.authenticate(provider,user).then(function(res){$state.go("my-wishlist",{id:$rootScope.facebook})})["catch"](function(err){})}}function WishlistCtrl($scope,$state,$auth,$http,$window,$rootScope,$stateParams,UserSvc,getUser){if(!$auth.isAuthenticated())return $state.go("home");$scope.like_heart=!1,$scope.favoriteWishlist=!1,$rootScope.user=getUser.data,$rootScope.id=getUser.data._id,$rootScope.birthday=getUser.data.birthday,void 0==$rootScope.birthday&&($rootScope.birthday=" N/A "),$rootScope.display_name=getUser.data.displayName,$rootScope.email=getUser.data.email,$rootScope.pro_pic=getUser.data.facebook,$rootScope.items=getUser.data.items,$rootScope.friendsLength=getUser.data.friends.length,$rootScope.favorites=getUser.data.favorites,$rootScope.followersCount=getUser.data.followers.length,$rootScope.followingCount=getUser.data.following.length,$rootScope.followingArr=getUser.data.following,$rootScope.followersArr=getUser.data.followers,$rootScope.privacy=getUser.data["private"],1==$rootScope.privacy?($scope["public"]=!1,$scope["private"]=!0):0==$rootScope.privacy&&($scope["public"]=!0,$scope["private"]=!1),$rootScope.favoritedByArr=getUser.data.favoritedBy,$rootScope.favoritedByLength=getUser.data.favoritedBy.length;var allFavoritedBy=$rootScope.favoritedByArr;allFavoritedBy.length===$rootScope.favoritedByArrLength||UserSvc.displayFaves(allFavoritedBy).then(function(res){var allFavoritedBy=res.data;$rootScope.favoritedByModel=[];for(var i=0;i<allFavoritedBy.length;i++){var eachFavoritedBy=allFavoritedBy[i],name=eachFavoritedBy.displayName,fbookId=eachFavoritedBy.facebook;$rootScope.favoritedByModel[i]={name:name,fbookId:fbookId}}})["catch"](function(err){}),$scope.goToFollowing=function(){$rootScope.followingPage=!0,$rootScope.followersPage=!1,$rootScope.settings=!1,$rootScope.starred=!1;var allFollowing=$rootScope.followingArr;$rootScope.followingCount===$rootScope.currentFollowingLength||UserSvc.showFollow(allFollowing).then(function(response){var theFollowing=response.data;$rootScope.currentFollowingLength=theFollowing.length,$rootScope.followingModel=[];for(var i=0;i<theFollowing.length;i++){var eachFollowing=theFollowing[i],name=eachFollowing.displayName,id=eachFollowing.facebook;$rootScope.followingModel[i]={name:name,id:id}}})},$scope.goToFollowers=function(){$rootScope.followersPage=!0,$rootScope.followingPage=!1,$rootScope.settings=!1,$rootScope.starred=!1;var allFollowers=$rootScope.followersArr;$rootScope.followersCount===$rootScope.currentFollowersLength||UserSvc.showFollow(allFollowers).then(function(response){var theFollowers=response.data;$rootScope.currentFollowersLength=theFollowers.length,$rootScope.followersModel=[];for(var i=0;i<theFollowers.length;i++){var eachFollower=theFollowers[i],name=eachFollower.displayName,id=eachFollower.facebook;$rootScope.followersModel[i]={name:name,id:id}}})},$scope.add=function(item,user){$scope.name=item.name,$scope.link=item.link;var userId=$scope.user._id;$scope.item.user=userId,UserSvc.add_new(item).then(function(){$scope.items.push({name:$scope.name,link:$scope.link,user:userId}),$scope.item.name="",$scope.item.link=""})["catch"](function(err){}),swal({title:"Good job!",text:"You added the item!",type:"success",timer:2e3})},$scope.like_item=function(item){UserSvc.likeItem(item)},$scope.edit=function(item,$index){$rootScope.editItemIndex=$index,$scope.item={},$scope.item.link=item.link,$scope.item.name=item.name,$scope.editItemId=item._id},$scope.save_changes=function(item,editItemId){$scope.item.name=item.name,$scope.item.link=item.link,$scope.item.id=editItemId,UserSvc.save_changes(item).then(function(res){var itemAfterEdit={name:res.data.name,link:res.data.link};$scope.items.splice($rootScope.editItemIndex,1,itemAfterEdit),$("#edit").modal("hide"),$("body").removeClass("modal-open"),$(".modal-backdrop").remove()})["catch"](function(){})},$scope["delete"]=function(item,$index){$scope.items.splice($index,1),UserSvc.delete_item(item,$index)},$scope.goToSettings=function(){$rootScope.settings=!0,$rootScope.followersPage=!1,$rootScope.followingPage=!1,$rootScope.starred=!1,$scope.makePrivate=function(){var loggedInUser=$rootScope.user;UserSvc.makePrivate(loggedInUser).then(function(){})["catch"](function(){}),$scope["private"]=!0,$scope["public"]=!1},$scope.makePublic=function(){var loggedInUser=$rootScope.user;UserSvc.makePublic(loggedInUser).then(function(){})["catch"](function(){}),$scope["private"]=!1,$scope["public"]=!0}},$scope.sort_list=function(){var newOrder=$scope.items;UserSvc.saveOrder(newOrder)},$scope.sortableOptions={update:function(e,ui){$scope.sort_list()},axis:"y"},$scope.goToStarred=function(){$rootScope.starred=!0,$rootScope.followersPage=!1,$rootScope.followingPage=!1,$rootScope.settings=!1},$scope.goToOthers=function(otherUser){var myId=getUser.data.facebook,fid=otherUser.id||otherUser.fbookId;$("#showFavBy").modal("hide"),$("body").removeClass("modal-open"),$(".modal-backdrop").remove(),$state.go("friend-wishlist",{id:myId,fid:fid})};var counter=0;$rootScope.favorites.length===getUser.data.favorites.length?0===counter&&UserSvc.showFavoritesData().then(function(response){var favsLength=response.data.favorites.length,favObj=response.data.favorites;$scope.favsModel=[];for(var i=0;i<favsLength;i++)$scope.favsModel[i]={name:favObj[i].displayName,id:favObj[i].facebook};$rootScope.starredLength=$scope.favsModel.length,counter++})["catch"](function(err){}):UserSvc.showFavoritesData().then(function(response){var favsLength=response.data.favorites.length,favObj=response.data.favorites;$scope.favsModel=[];for(var i=0;i<favsLength;i++)$scope.favsModel[i]={name:favObj[i].displayName,id:favObj[i].facebook};$rootScope.starredLength=$scope.favsModel.length})["catch"](function(err){})}function faqCtrl($rootScope,$scope){localStorage.setItem("faq","in faq"),localStorage.getItem("satellizer_token")?$rootScope.infaq=localStorage.removeItem("faq"):$rootScope.infaq=localStorage.getItem("faq"),$scope.faqs=[{question:"1. Why arent my links working?",answer:"Make sure you have the http(s):/ /www; The best way to accomplish copying the links is by copying the url & simply plasting it in the input box."},{question:"2. I have ideas to improve the app; How can I let you guys know?",answer:"Simply click the email icon on the bottom and email us!"},{question:"3. Can I share this with my friends?",answer:"The app is currently in beta; please limit invites to just 5 friends"},{question:"4. Why can't I see anyone in the searchbar?",answer:"Only your Facebook friends who are already using the app can be seen"},{question:"5. I try to use the app on my iPhone using Safari, but I'm having issues",answer:"Go to settings --> safari --> privacy & security --> block cookies --> allow from websites I visit. Also make sure you have JavaScript enabled in the Advanced Section"},{question:"6. It's not working on my web browser (Google Chrome, Safari, FireFox, etc.). How can I fix it?",answer:"Extensions like Adblock might interfere with the Login with Facebook button, preventing you from logginong onto the app"}],$scope.getAnswer=function(){$scope.showAnswer?$scope.showAnswer=!1:$scope.showAnswer=!0}}function FriendlistCtrl($scope,$state,$auth,$http,$window,UserSvc,$rootScope,$stateParams,getUser,getFriend){$scope.followersPage=!1,$scope.followingPage=!1,$rootScope.user=getUser.data;var favoritesIdArr=getUser.data.favorites,followingFriendIdArr=getUser.data.following,likedItemsArr=getUser.data.liked;$rootScope.display_name=getUser.data.displayName,$scope.user=getFriend.data,$scope.id=getFriend.data._id,$scope.items=getFriend.data.items,$rootScope.friendFollowers=getFriend.data.followers,$rootScope.friendFollowing=getFriend.data.following,$scope.display_name=getFriend.data.displayName,$scope.email=getFriend.data.email,$scope.pro_pic=getFriend.data.facebook,$scope.following=getFriend.data.following.length,$scope.followers=getFriend.data.followers.length,$scope.birthday=getFriend.data.birthday,void 0==$scope.birthday&&($scope.birthday=" N/A ");var friendFavId=getFriend.data._id;favoritesIdArr.indexOf(friendFavId)>-1&&($rootScope.yellowStar="star_btn",$scope.favWishList=!0),followingFriendIdArr.indexOf($scope.id)>-1?$rootScope.follow=!0:$rootScope.follow=!1;for(var friendFriendArray=[],friendsIdArr=[],i=0;i<getFriend.data.friends.length;i++){var friendFriendName=getFriend.data.friends[i].name,friendId=getFriend.data.friends[i].id;friendFriendArray.push(friendFriendName),friendsIdArr.push(friendId)}$scope.friends=friendFriendArray,$scope.friendsLength=friendFriendArray.length;for(var friendItems=getFriend.data.items,allTheLikedItemsArr=[],i=0;i<friendItems.length;i++){var each_likeable_item=friendItems[i]._id;likedItemsArr.indexOf(each_likeable_item)>-1&&(allTheLikedItemsArr.push(i),$scope.like_heart=allTheLikedItemsArr)}$rootScope.friendFavoritedByArr=getFriend.data.favoritedBy,$rootScope.favoritedByLength=getFriend.data.favoritedBy.length;var allFriendFavoritedBy=$rootScope.friendFavoritedByArr;UserSvc.displayFaves(allFriendFavoritedBy).then(function(response){var allFriendFavoritedBy=response.data;$rootScope.favoritedByModel=[];for(var i=0;i<allFriendFavoritedBy.length;i++){var eachFriendFavoritedBy=allFriendFavoritedBy[i],name=eachFriendFavoritedBy.displayName,fbookId=eachFriendFavoritedBy.facebook;$rootScope.favoritedByModel[i]={name:name,fbookId:fbookId}}})["catch"](function(err){}),$scope.like_item=function(item,$index){if(void 0!=$scope.like_heart&&$scope.like_heart.indexOf($index)>-1){var parsed=parseInt($index),arrayToRemoveFrom=$scope.like_heart;arrayToRemoveFrom.splice(arrayToRemoveFrom.indexOf(parsed),1)}else void 0==$scope.like_heart?($scope.like_heart=[],$scope.like_heart.push($index)):void 0!=$scope.like_heart&&$scope.like_heart.push($index);UserSvc.likeItem(item).then(function(res){})["catch"](function(err){})},$scope.star=function(user){$scope.favWishList?$scope.favWishList=!1:$scope.favWishList="is_favoriting",void 0===$rootScope.yellowStar?$rootScope.yellowStar="star_btn":$rootScope.yellowStar=void 0,UserSvc.starPerson(user),window.location.reload(!0)},$scope.followUser=function(user){var tmpFriendId=user._id;followingFriendIdArr.indexOf(tmpFriendId)>-1?(followingFriendIdArr.pop(tmpFriendId),$scope.unfollow=!1):(followingFriendIdArr.push(tmpFriendId),window.location.reload()),UserSvc.followPerson(user)},$scope.unfollowBtnShow=function(){$rootScope.follow=!1,$rootScope.unfollow=!0},$scope.followBtnShow=function(){$rootScope.follow=!0,$rootScope.unfollow=!1},$scope.goToFollowers=function(){$scope.followersPage=!0,$scope.followingPage=!1;var allFollowers=$rootScope.friendFollowers;UserSvc.showFollow(allFollowers).then(function(response){var theFollowers=response.data;$scope.followersModel=[];for(var i=0;i<theFollowers.length;i++){var eachFollower=theFollowers[i],name=eachFollower.displayName,id=eachFollower.facebook;$scope.followersModel[i]={name:name,id:id}}})},$scope.goToFollowing=function(){$scope.followingPage=!0,$scope.followersPage=!1;var allFollowing=$rootScope.friendFollowing;UserSvc.showFollow(allFollowing).then(function(response){var theFollowing=response.data;$scope.followingModel=[];for(var i=0;i<theFollowing.length;i++){var eachFollowing=theFollowing[i],name=eachFollowing.displayName,id=eachFollowing.facebook;$scope.followingModel[i]={name:name,id:id}}})},$scope.goToOthers=function(otherUser){var myId=getUser.data.facebook,fid=otherUser.id||otherUser.fbookId;$("#showFavBy").modal("hide"),$("body").removeClass("modal-open"),$(".modal-backdrop").remove(),$state.go("friend-wishlist",{id:myId,fid:fid})}}function UserSvc($http){return{getProfile:function(){return $http.get("/api/me")},friendProfile:function(friendId){return $http.post("/api/me/friend",{params:{fid:friendId}})},showFollow:function(allFriendIds){return $http.post("/api/friend/showfriendfollows",{params:{friendIds:allFriendIds}})},displayFaves:function(allFavoritedBy){return $http.post("/api/me/favoritedby",{params:{favoritedByIds:allFavoritedBy}})},add_new:function(item){var item;return $http.post("/api/me/items",item)},delete_item:function(item,$index){return $http.put("/api/me/deleteitem",item)},save_changes:function(item){var item;return $http.put("/api/me/edititem",item)},starPerson:function(user){return $http.put("/api/me/favorite",user)},saveOrder:function(newOrder){return $http.put("/api/me/itemreorder",newOrder)},likeItem:function(item){return $http.put("/api/items/liked",item)},showFavoritesData:function(){return $http.get("/api/favoritesdata")},followPerson:function(user){return $http.put("/api/me/following",user)},makePrivate:function(loggedInUser){return $http.put("/api/me/makeprivate")},makePublic:function(loggedInUser){return $http.put("/api/me/makepublic")},checkingFriendPrivacy:function(userFriends){for(var friendsToCheck=[],i=0;i<userFriends.length;i++){var mongoId=userFriends[i].id;friendsToCheck.push(mongoId)}return $http.post("/api/me/checkfriendprivacy",{friends:friendsToCheck})}}}function StarSvc($http){return{get_friends:function(){return $http.get("/api/me/friends")}}}angular.module("App",["ui.router","satellizer","app.routes","ui.sortable"]),angular.module("app.routes",[]).config(["$stateProvider","$urlRouterProvider","$locationProvider","$authProvider",AppRoutes]),angular.module("App").controller("HomeCtrl",HomeCtrl),HomeCtrl.$inject=["$scope","$rootScope","$state","$auth","$http","UserSvc"],angular.module("App").controller("NavbarCtrl",NavbarCtrl),NavbarCtrl.$inject=["$scope","$state","$auth","$rootScope","UserSvc"],angular.module("App").controller("WishlistCtrl",WishlistCtrl),WishlistCtrl.$inject=["$scope","$state","$auth","$http","$window","$rootScope","$stateParams","UserSvc","getUser"],angular.module("App").controller("faqCtrl",faqCtrl),faqCtrl.$inject=["$rootScope","$scope"],angular.module("App").controller("FriendlistCtrl",FriendlistCtrl),FriendlistCtrl.$inject=["$scope","$state","$auth","$http","$window","UserSvc","$rootScope","$stateParams","getUser","getFriend"],angular.module("App").factory("UserSvc",UserSvc),UserSvc.$inject=["$http"],angular.module("App").factory("StarSvc",StarSvc),StarSvc.$inject=["$http"];